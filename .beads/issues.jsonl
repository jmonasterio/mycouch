{"id":"mycouch-052","title":"Test workspace tenants and invitations","description":"Unit: isPersonal flag enforcement, invitation validation for workspaces only, role checks, token generation/validation, single-use enforcement. Integration: create workspace, invite user, accept, verify membership. E2E: create workspace, invite, accept, verify access. Security: cannot invite to personal, timing attacks, invalid tokens, token reuse.","status":"open","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:35:27.3178835-08:00","updated_at":"2025-12-07T18:14:18.799552-08:00","dependencies":[{"issue_id":"mycouch-052","depends_on_id":"mycouch-1gw","type":"blocks","created_at":"2025-12-07T18:14:13.9233986-08:00","created_by":"daemon"},{"issue_id":"mycouch-052","depends_on_id":"mycouch-7dc","type":"blocks","created_at":"2025-12-07T18:14:14.7474428-08:00","created_by":"daemon"},{"issue_id":"mycouch-052","depends_on_id":"mycouch-2be","type":"blocks","created_at":"2025-12-07T18:14:15.5813971-08:00","created_by":"daemon"},{"issue_id":"mycouch-052","depends_on_id":"mycouch-2ao","type":"blocks","created_at":"2025-12-07T18:14:16.4032986-08:00","created_by":"daemon"}]}
{"id":"mycouch-07n","title":"M6: API documentation and client integration guide","description":"Document virtual endpoints, request/response patterns, error codes. Write guide for PouchDB sync setup. Include Clerk JWT configuration.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T07:20:15.7350495-08:00","updated_at":"2025-12-10T07:20:15.7350495-08:00","dependencies":[{"issue_id":"mycouch-07n","depends_on_id":"mycouch-sac","type":"blocks","created_at":"2025-12-10T07:20:26.2842957-08:00","created_by":"daemon"}]}
{"id":"mycouch-1gw","title":"Add workspace tenant support with isPersonal flag","description":"Update tenant schema: add userId (owner), userIds array, metadata.autoCreated. No isPersonal flag needed â€” personal vs workspace distinction tracked in User.tenants[].personal field only. Update couch_sitter_service to auto-create tenant for first login with autoCreated=true.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:35:07.6005029-08:00","updated_at":"2025-12-07T18:17:12.4296355-08:00","closed_at":"2025-12-07T18:17:12.4296355-08:00"}
{"id":"mycouch-1np","title":"Document CouchDB security setup","description":"Create docs/couchdb-security.md covering admin party, HTTPS/TLS, credentials, design docs, security documents, replication.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:22:20.64257-08:00","updated_at":"2025-12-07T17:36:23.6001994-08:00","closed_at":"2025-12-07T17:36:23.6001994-08:00"}
{"id":"mycouch-2ao","title":"Implement authorization checks for tenants and invitations","description":"Universal owner rules: cannot be removed, cannot be downgraded, only owner can delete/change roles. Authorization per PRD table: Owner all actions, Admin updates/invites/remove members (workspace only), Member read+access only. Invitations only on workspace tenants (User.tenants[].personal=false). Check role enforcement at API level.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:35:20.485924-08:00","updated_at":"2025-12-07T18:17:17.3197643-08:00","closed_at":"2025-12-07T18:17:17.3197643-08:00"}
{"id":"mycouch-2be","title":"Add workspace tenant and invitation API endpoints","description":"Add API endpoints: POST /tenants (create workspace), GET /my-tenants (list user's tenants), GET /tenants/{id}, PUT/DELETE /tenants/{id}. Invitations: POST /tenants/{id}/invitations, GET /invitations/preview, POST /invitations/accept, DELETE /tenants/{id}/invitations/{id}, POST /tenants/{id}/invitations/{id}/resend. Member mgmt: PUT/DELETE /tenants/{id}/members/{id}/role. Per prd-shared-tenants-invitations.md","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:35:14.244829-08:00","updated_at":"2025-12-07T18:17:16.3722641-08:00","closed_at":"2025-12-07T18:17:16.3722641-08:00"}
{"id":"mycouch-2lr","title":"M3: User CRUD operations and access control","description":"GET, PUT, DELETE for __users. Validate allowed field edits (active_tenant_id, email, metadata). Protect immutable fields (clerk_id, type, _id). Prevent self-delete. Return correct HTTP codes.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T07:19:59.8718659-08:00","updated_at":"2025-12-10T07:46:01.4844376-08:00","closed_at":"2025-12-10T07:46:01.4844376-08:00","dependencies":[{"issue_id":"mycouch-2lr","depends_on_id":"mycouch-i1p","type":"blocks","created_at":"2025-12-10T07:20:21.157246-08:00","created_by":"daemon"}]}
{"id":"mycouch-2uz","title":"M3: Tenant CRUD operations and ownership enforcement","description":"GET, POST, PUT, DELETE for __tenants. Validate ownership (only owner can read/write/delete). Prevent deletion of active tenant. Soft-delete only. Field validation (immutable: type, _id, owner_user_id).","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T07:20:00.9298635-08:00","updated_at":"2025-12-10T07:46:02.2346633-08:00","closed_at":"2025-12-10T07:46:02.2346633-08:00","dependencies":[{"issue_id":"mycouch-2uz","depends_on_id":"mycouch-i1p","type":"blocks","created_at":"2025-12-10T07:20:22.0215368-08:00","created_by":"daemon"}]}
{"id":"mycouch-3rr","title":"Implement rate limiting on auth endpoints","description":"Add slowapi rate limiting to /my-tenants (30/min) and /choose-tenant (10/min) endpoints. Prevents DoS and brute force attacks.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:22:11.204635-08:00","updated_at":"2025-12-07T16:23:53.5738146-08:00","closed_at":"2025-12-07T16:23:53.5738146-08:00"}
{"id":"mycouch-4rx","title":"M5: Unit tests for virtual tables, bootstrap, and CRUD","description":"Test all CRUD operations, bootstrap flow, field validation, access control, soft-delete, error codes. Cover edge cases: immutable fields, self-delete, ownership.","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2025-12-10T07:20:12.8761949-08:00","updated_at":"2025-12-10T08:08:20.9837939-08:00","dependencies":[{"issue_id":"mycouch-4rx","depends_on_id":"mycouch-d3q","type":"blocks","created_at":"2025-12-10T07:20:24.6649124-08:00","created_by":"daemon"}]}
{"id":"mycouch-7dc","title":"Implement invitation service and token handling","description":"Create invite_service.py with secure token generation (sk_ prefix, 256-bit), single-use validation, expiration checks (7 days default), email verification matching. Use hmac.compare_digest for timing-attack resistance. Token stored as SHA256 hash.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:35:10.761547-08:00","updated_at":"2025-12-07T18:17:15.7312999-08:00","closed_at":"2025-12-07T18:17:15.7312999-08:00"}
{"id":"mycouch-8dy","title":"M6: Migration guide for removing old REST endpoints","description":"Document deprecation and removal of old user/tenant REST endpoints. Map old endpoints to new virtual tables. Provide client migration path.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T07:20:16.9614309-08:00","updated_at":"2025-12-10T07:20:16.9614309-08:00","dependencies":[{"issue_id":"mycouch-8dy","depends_on_id":"mycouch-07n","type":"blocks","created_at":"2025-12-10T07:20:27.0164286-08:00","created_by":"daemon"}]}
{"id":"mycouch-aub","title":"M4: PouchDB _changes feed filtering and sync support","description":"Implement _changes endpoint for __users and __tenants. Filter results: membership checks, exclude soft-deleted, include docs. Support since parameter.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T07:20:01.9791704-08:00","updated_at":"2025-12-10T08:08:16.3201202-08:00","closed_at":"2025-12-10T08:08:16.3201202-08:00","dependencies":[{"issue_id":"mycouch-aub","depends_on_id":"mycouch-2lr","type":"blocks","created_at":"2025-12-10T07:20:22.6934067-08:00","created_by":"daemon"},{"issue_id":"mycouch-aub","depends_on_id":"mycouch-2uz","type":"blocks","created_at":"2025-12-10T07:20:23.3424644-08:00","created_by":"daemon"}]}
{"id":"mycouch-ba4","title":"Remove redundant tenant_user_mapping documents","description":"Eliminate duplicate role data by querying user documents directly instead of maintaining separate tenant_user_mapping docs. This simplifies the data model and removes data consistency issues.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T21:49:52.9159885-08:00","updated_at":"2025-12-09T22:10:58.6654226-08:00","closed_at":"2025-12-09T22:10:58.6654226-08:00"}
{"id":"mycouch-cw5","title":"Add session/auth logging and monitoring","description":"Log all auth events (successful/failed), tenant switches, unauthorized access. Alert on suspicious patterns.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:22:15.9548897-08:00","updated_at":"2025-12-07T17:01:04.6405998-08:00","closed_at":"2025-12-07T17:01:04.6405998-08:00"}
{"id":"mycouch-d3q","title":"M4: Bulk operations handler (_bulk_docs) with validation","description":"POST /_bulk_docs for __users and __tenants. Validate each doc (access control, immutable fields), perform CouchDB operations, return per-doc status array.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T07:20:03.0444527-08:00","updated_at":"2025-12-10T08:08:16.3251981-08:00","closed_at":"2025-12-10T08:08:16.3251981-08:00","dependencies":[{"issue_id":"mycouch-d3q","depends_on_id":"mycouch-aub","type":"blocks","created_at":"2025-12-10T07:20:23.9888183-08:00","created_by":"daemon"}]}
{"id":"mycouch-ej8","title":"Add auth logging to couch-sitter-log database","description":"Log all auth requests to new couch-sitter-log CouchDB. Include enough info for searching/reporting: user_id, tenant_id, endpoint, action, status, timestamp, IP. Reuse existing CouchDB connection machinery.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:32:37.53264-08:00","updated_at":"2025-12-07T17:26:29.2008288-08:00","closed_at":"2025-12-07T17:26:29.2008288-08:00"}
{"id":"mycouch-gbu","title":"Build PWA UI for workspaces and invitations","description":"Show user's personal tenant + workspace tenants in UI. Create workspace tenant form (isPersonal=false). Invite users to workspaces (blocked for personal). Manage members/roles. Accept invitation flow. Preview before accepting. Show only relevant actions based on isPersonal flag and user role.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-07T17:35:23.6966444-08:00","updated_at":"2025-12-07T18:00:31.8540727-08:00"}
{"id":"mycouch-hz7","title":"Prevent personal tenant deletion","description":"Add validation to prevent deletion of personal tenants. Check tenant.personal flag and tenant.owner_id before allowing deletion.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:22:24.9882336-08:00","updated_at":"2025-12-07T17:36:23.6045998-08:00","closed_at":"2025-12-07T17:36:23.6045998-08:00"}
{"id":"mycouch-i1p","title":"M2: Implement bootstrap logic and JWT refresh workflow","description":"Detect missing active_tenant_id in JWT. Create user doc + personal tenant on first access. Return 401 with X-Clerk-Refresh-Required header. Integrate Clerk JWT refresh flow.","status":"open","priority":0,"issue_type":"feature","created_at":"2025-12-10T07:19:58.5913102-08:00","updated_at":"2025-12-10T07:33:19.3529234-08:00","dependencies":[{"issue_id":"mycouch-i1p","depends_on_id":"mycouch-odf","type":"blocks","created_at":"2025-12-10T07:20:20.500552-08:00","created_by":"daemon"}]}
{"id":"mycouch-odf","title":"M1: Setup virtual table routing and ID mapping utility","description":"Setup virtual table routing (__users, __tenants) with simple ID prefix mapping (user_*, tenant_*). No translation logic needed.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T07:19:57.1883292-08:00","updated_at":"2025-12-10T07:45:57.4682559-08:00","closed_at":"2025-12-10T07:45:57.4682559-08:00"}
{"id":"mycouch-oob","title":"Add email integration for invitations","description":"Set up email service (SendGrid/Resend/AWS SES). Create email template with invite link. Add env config. Implement email sending on invite creation and resend endpoint.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-07T17:35:17.4605162-08:00","updated_at":"2025-12-07T17:35:17.4605162-08:00"}
{"id":"mycouch-rc6","title":"Implement suspicious auth pattern detection and alerting","description":"Detect and alert on suspicious patterns: multiple failed logins from same IP, rapid tenant switches, unusual access patterns, repeated access denied. Use logs collected in couch-sitter-log database to identify and notify on threats.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:01:03.4153828-08:00","updated_at":"2025-12-07T17:36:23.5939081-08:00","closed_at":"2025-12-07T17:36:23.5939081-08:00"}
{"id":"mycouch-sac","title":"M5: Integration tests for PouchDB sync and tenant switching","description":"Test PouchDB replication against __users and __tenants. Verify _changes feed, _bulk_docs, tenant switching (active_tenant_id updates).","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-10T07:20:14.2781905-08:00","updated_at":"2025-12-10T07:20:14.2781905-08:00","dependencies":[{"issue_id":"mycouch-sac","depends_on_id":"mycouch-4rx","type":"blocks","created_at":"2025-12-10T07:20:25.3917398-08:00","created_by":"daemon"}]}
{"id":"mycouch-idf","title":"Fix ID hash mismatch between bootstrap and virtual tables","description":"PROBLEM: Critical mismatch between how user IDs are handled. Bootstrap creates user doc as user_{clerk_sub} (e.g. user_34tzJwWB3jaQT6ZKPqZIQoJwsmz) but frontend hashes clerk sub to 64-char hex before calling PUT /__users/{hash}. Backend then looks for user_{hash} which doesn't exist. AFFECTED: bootstrap.py:62 creates unhashed, virtual_tables.py:43-46 expects hashed, tenant-manager.js:54-61 hashes before API calls. WHAT WORKS: GET /__tenants (queries by userIds containing clerk sub), POST /__tenants (uses clerk sub as owner). WHAT BREAKS: PUT /__users/{id} (ID mismatch). SOLUTION: Updated bootstrap.py to hash the clerk sub before creating user doc. Also fixed tenant userIds to store clerk sub (not hash) for consistency with virtual_tables queries. Test updated. 41/45 tests pass (4 pre-existing failures unrelated to this change). Related: roady-bo0, roady-g56.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-29T18:00:00.000Z","updated_at":"2025-12-29T18:30:00.000Z","closed_at":"2025-12-29T18:30:00.000Z"}
{"id":"mycouch-cs1","title":"CrowdStrike kills FastAPI+uvicorn proxy but not stdlib proxy","description":"PROBLEM: CrowdStrike EDR kills FastAPI+uvicorn processes (exit 127) but NOT stdlib http.server doing identical proxy work. Both receive browser requests and forward to CouchDB. WHAT TRIGGERS KILL: FastAPI+uvicorn with proxy routes. Tested httpx, urllib, ThreadPoolExecutor - all killed. WHAT SURVIVES: (1) stdlib http.server with same proxy logic, (2) FastAPI WITHOUT proxy routes (lifespan HTTP calls OK), (3) Python-to-Python requests without browser. ROOT CAUSE: CrowdStrike detects async socket multiplexing + keep-alive patterns that look like modern malware relays. uvicorn maintains persistent TCP connections, uses async multiplexing, reuses file descriptors aggressively. stdlib http.server uses new socket per request, close-after-response, blocking I/O - looks like boring 1998 tool. TESTED MITIGATIONS (ALL FAILED): (1) timeout_keep_alive=0 + Connection:close headers - KILLED, (2) --workers 2 multiprocess mode - KILLED (workers keep dying). SOLUTION: Use stdlib_server.py for local dev, FastAPI for production. Refactored to share core/ module - stdlib_server.py reduced from 687 to 301 lines. Files: stdlib_server.py, src/couchdb_jwt_proxy/core/, CROWDSTRIKE_DEBUG.md.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-01T12:00:00.000Z","updated_at":"2026-01-02T12:00:00.000Z","closed_at":"2026-01-02T12:00:00.000Z"}
{"id":"mycouch-mix1","title":"Band data mixes when switching mycouch URL","description":"PROBLEM: When switching the mycouch URL (perhaps even when not connected), user ends up with a mix of different bands' data. SYMPTOMS: Data from multiple bands appears mixed together. LIKELY CAUSE: IndexedDB/PouchDB local database not being cleared or isolated when switching backends. The local DB may contain stale data from a different band/tenant that gets mixed with new data. INVESTIGATION NEEDED: (1) Check how roady handles mycouch URL changes, (2) Check if local PouchDB is cleared on URL change, (3) Check tenant_id filtering in sync, (4) Check if active_tenant_id in JWT matches local data. RELATED: tenant isolation, PouchDB sync, active_tenant_id. FILES: roady js/db.js, roady tenant-manager.js, mycouch virtual_tables.py.","status":"open","priority":0,"issue_type":"bug","created_at":"2026-01-02T12:00:00.000Z","updated_at":"2026-01-02T12:00:00.000Z"}
