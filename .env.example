# ============================================================
# COUCHDB JWT PROXY - ENVIRONMENT CONFIGURATION
# ============================================================
# IMPORTANT: Never commit this file to version control.
# Copy this file to .env and fill in the actual values.
# ============================================================

# ============================================================
# JWT AUTHENTICATION - CLERK (RS256)
# ============================================================

# Clerk JWT Validation (RS256 - asymmetric)
# REQUIRED: Your Clerk issuer URL for JWT validation
# Format: https://your-instance.clerk.accounts.dev
# Find this in your Clerk Dashboard → Configure → API Keys → Issuer URL
CLERK_ISSUER_URL=https://clerk.argw.com

# Clerk Backend API for session metadata management
# REQUIRED: Your Clerk Secret Key for Backend API access
# Format: sk_test_xxx or sk_live_xxx
# Find this in your Clerk Dashboard → Configure → API Keys → Secret Key
# Used for active tenant management and session metadata
CLERK_SECRET_KEY=sk_test_fake_key_for_testing_only

# ============================================================
# COUCHDB CONFIGURATION
# ============================================================

# Internal CouchDB URL (not exposed to public, only for proxy)
# For local Docker: http://localhost:5984
# For Linux server: http://couchdb.example.com:5984 (or 127.0.0.1:5984)
COUCHDB_INTERNAL_URL=http://localhost:5984

# CouchDB credentials for proxy authentication (RECOMMENDED)
# These are used by the proxy to connect to CouchDB internally
# The proxy will automatically use these credentials for all requests to CouchDB
# Leave empty if your CouchDB doesn't require authentication (not recommended for production)
COUCHDB_USER=admin
COUCHDB_PASSWORD=admin

# Couch-sitter database configuration for user and tenant management
# This database stores user documents and personal tenant information
# The proxy will automatically create users and personal tenants as needed
COUCH_SITTER_DB_URL=http://localhost:5984/couch-sitter

# Couch-sitter-log database for authentication audit logging
# Logs all auth events (login, tenant_switch, access_denied, rate_limited, token_validation)
# OPTIONAL: If not set, auth logging is disabled
COUCH_SITTER_LOG_DB_URL=http://localhost:5984/couch-sitter-log

# User cache TTL (Time-To-Live) in seconds
# How long to cache user/tenant information in memory before refreshing from database
# Default: 300 seconds (5 minutes)
USER_CACHE_TTL_SECONDS=300

# ============================================================
# PROXY SERVER CONFIGURATION
# ============================================================

# Listen IP address
# 0.0.0.0 = all network interfaces (accessible remotely)
# 127.0.0.1 = localhost only (not accessible remotely)
# 192.168.1.100 = specific interface
PROXY_HOST=0.0.0.0

# Listen port (default CouchDB is 5984, proxy uses 5985)
PROXY_PORT=5985

# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# ============================================================
# MULTI-TENANT CONFIGURATION (Always Enabled)
# ============================================================

# Document field name for tenant isolation
# Documents will be automatically isolated by SHA256 hash of JWT sub claim
# Each user gets their own isolated data space
TENANT_FIELD=tenant_id

# ============================================================
# TESTING - INTEGRATION TEST JWT TOKEN (Optional)
# ============================================================

# JWT token for manual integration tests
# Get this from: Roady → Settings → Options → Authentication (Copy button)
# Or from: Clerk Dashboard → Users → [user] → Sessions
# Used by: tests/test_virtual_endpoints_manual.py
# IMPORTANT: Never commit real tokens to version control
JWT_TOKEN=

# Skip JWT expiration validation (development/testing only)
# Set to "true" to allow expired tokens in tests
# WARNING: Only use for development - DO NOT enable in production!
# Default: false (expiration is checked)
SKIP_JWT_EXPIRATION_CHECK=false
